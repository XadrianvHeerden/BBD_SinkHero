<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Multiplayer Game</title>
    <script src="/socket.io/socket.io.js"></script>
    <script>
        document.addEventListener("DOMContentLoaded", () => {
            const socket = io();

            document.getElementById('joinButton').addEventListener('click', () => {
                const name = document.getElementById('nameInput').value;
                if (name) {
                    socket.emit('setName', { name: name });
                    document.getElementById('gameInfo').innerHTML = ` `;
                }
            });

            document.getElementById('startButton').addEventListener('click', () => {
                socket.emit('startGame');
            });

            socket.on('waiting', (data) => {
                document.getElementById('waitingMessage').style.display = '';
                document.getElementById('waitingMessage').innerText = `Waiting for more players... (${data.playersCount}/4)`;
                if(data.playersCount >= 2){
                    document.getElementById('startSection').style.display = '';
                }
            });

            socket.on('gameStart', (data) => {
                console.log(`Game ${data.gameId} started. You are player ${data.playerId} (Name: ${data.name})`);
                document.getElementById('gameInfo').innerHTML = `
                    <h2>Game Started!</h2>
                    <p>Game ID: ${data.gameId}</p>
                    <p>You are Player ${data.playerId} (Name: ${data.name})</p>
                `;
                document.getElementById('joinSection').style.display = 'none';
                document.getElementById('startSection').style.display = 'none';
                document.getElementById('waitingMessage').style.display = 'none';
            });

            socket.on('playerLeft', (data) => {
                console.log(`Player ${data.playerId} left the game`);
            });

            document.getElementById('listGamesButton').addEventListener('click', () => {
            fetch('/games')
                .then(response => response.json())
                .then(data => {
                    const gamesList = document.getElementById('gamesList');
                    gamesList.innerHTML = '';
                    data.forEach(game => {
                        const gameItem = document.createElement('div');
                        gameItem.innerHTML = `
                            <h3>Game ${game.gameId}</h3>
                            <p>Players: ${game.players.join(', ')}</p>
                        `;
                        gamesList.appendChild(gameItem);
                    });
                });
            });

            socket.on('gameEnded', (data) => {
                console.log(`Game ${data.gameId} ended due to insufficient players.`);
                document.getElementById('gameInfo').innerHTML = `
                    <h2>Game Ended</h2>
                    <p>Game ID: ${data.gameId} ended due to insufficient players.</p>
                `;
                document.getElementById('joinSection').style.display = 'block';
                document.getElementById('startSection').style.display = 'none';
            });
        });

        
    </script>
</head>
<body>
    <h1>Multiplayer Game</h1>
    <div id="joinSection">
        <input type="text" id="nameInput" placeholder="Enter your name">
        <button id="joinButton">Join Game</button>
    </div>
    <div id="waitingMessage"></div>
    <div id="startSection" style="display: none;">
        <button id="startButton">Start Game</button>
    </div>
    <div id="gameInfo"></div>
    <p>Open this page in multiple tabs to simulate multiple players connecting.</p>
    <div id="hostSection">
        <button id="listGamesButton">List Games</button>
        <div id="gamesList"></div>
    </div>
</body>
</html>
